<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Animate a point along a route</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
<script src="https://unpkg.com/papaparse@5.3.0/papaparse.min.js"></script>
<script src="https://unpkg.com/@mapbox/mapbox-sdk/umd/mapbox-sdk.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
<script
    src="https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v2.0.0/turf.min.js"
    charset="utf-8"
></script>
<script src="actorpath.js"></script>

<link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />
<style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<style>
    .overlay {
        position: absolute;
        top: 10px;
        left: 10px;
    }

    .overlay button {
        font: 600 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        background-color: #3386c0;
        color: #fff;
        display: inline-block;
        margin: 0;
        padding: 10px 20px;
        border: none;
        cursor: pointer;
        border-radius: 3px;
    }

    .overlay button:hover {
        background-color: #4ea0da;
    }
    .marker {
display: block;
border: none;
border-radius: 50%;
cursor: pointer;
padding: 0;
}
body {
  width: 100%;
  height: 100%;
}

.slideout-menu {
  position: fixed;
  top: 0;
  bottom: 0;
  width: 256px;
  min-height: 100vh;
  overflow-y: scroll;
  -webkit-overflow-scrolling: touch;
  z-index: 0;
  display: none;
  margin: 1em;
}

.slideout-menu-left {
  left: 0;
}

.slideout-menu-right {
  right: 0;
}

.slideout-panel {
  position: relative;
  z-index: 1;
  will-change: transform;
  background-color: #FFF; /* A background-color is required */
  min-height: 100vh;
}

.slideout-open,
.slideout-open body,
.slideout-open .slideout-panel {
  overflow: hidden;
}

.slideout-open .slideout-menu {
  display: block;
}

nav textarea {
    width: 80%;
    height: 50%;
    margin: auto;
}

</style>

<nav id="menu">
  <header>
    <h2>Menu</h2>
  </header>
  <textarea id="json">
{
   "Naomi":[
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":0,
         "stayDuration":1,
         "interior":1
      },
      {
         "name":"Sephora",
         "coordinates":[
            -73.99042372887936,
            40.692302258434665
         ],
         "time":6,
         "stayDuration":2
      },
      {
         "name":"Top Beauty",
         "coordinates":[
            -73.98724293447953,
            40.691923693517424
         ],
         "time":16,
         "stayDuration":5,
         "interior":1
      },
      {
         "name":"Top Beauty",
         "coordinates":[
            -73.98724293447953,
            40.691923693517424
         ],
         "time":21,
         "stayDuration":11
      },
      {
         "name":"Beauty 35",
         "coordinates":[
            -73.98399300000335,
            40.690241797368174
         ],
         "time":37,
         "stayDuration":2,
         "interior":1
      },
      {
         "name":"Beauty 35",
         "coordinates":[
            -73.98399300000335,
            40.690241797368174
         ],
         "time":39,
         "stayDuration":9
      },
      {
         "name":"McDonald's Flatbush Ave Extension",
         "coordinates":[
            -73.98080433071175,
            40.688885800079134
         ],
         "time":56,
         "stayDuration":18,
         "interior":1
      },
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":90,
         "stayDuration":10,
         "interior":1
      }
   ],
   "Rachel":[
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":0
      },
      {
         "name":"Michael's Atlantic Ave",
         "coordinates":[
            -73.99058908465565,
            40.688659714846835
         ],
         "time":7,
         "stayDuration":12,
         "interior":1
      },
      {
         "name":"Top Beauty",
         "coordinates":[
            -73.98724293447953,
            40.691923693517424
         ],
         "time":25,
         "stayDuration":7
      },
      {
         "name":"Beauty 35",
         "coordinates":[
            -73.98399300000335,
            40.690241797368174
         ],
         "time":37,
         "stayDuration":2,
         "interior":1
      },
      {
         "name":"Beauty 35",
         "coordinates":[
            -73.98399300000335,
            40.690241797368174
         ],
         "time":39,
         "stayDuration":8
      },
      {
         "name":"Beauty 35",
         "coordinates":[
            -73.98399300000335,
            40.690241797368174
         ],
         "time":47,
         "stayDuration":2,
         "interior":1
      },
      {
         "name":"Starbuck Court St",
         "coordinates":[
            -73.99122099998579,
            40.69234812360682
         ],
         "time":57,
         "stayDuration":15,
         "interior":1
      },
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":93,
         "stayDuration":7,
         "interior":1
      }
   ],
   "Nawan":[
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":0,
         "stayDuration":2,
         "interior":1
      },
      {
         "name":"Brooklyn House of Detention - across from",
         "coordinates":[
            -73.98939232701781,
            40.689565448764824
         ],
         "time":5,
         "stayDuration":9
      },
      {
         "name":"Albee Square",
         "coordinates":[
            -73.98344681831634,
            40.68994784305596
         ],
         "time":22,
         "stayDuration":4
      },
      {
         "name":"Transit Adjudication Bureau",
         "coordinates":[
            -73.98673281349062,
            40.69042539221124
         ],
         "time":32,
         "stayDuration":1
      },
      {
         "name":"McDonald's Fulton St",
         "coordinates":[
            -73.9861538135035,
            40.690823527448
         ],
         "time":34,
         "stayDuration":3
      },
      {
         "name":"Fort Greene Park",
         "coordinates":[
            -73.97663115992776,
            40.6904009717787
         ],
         "time":54,
         "stayDuration":11
      },
      {
         "name":"G Train Station Fulton St Stop Queens Bound",
         "coordinates":[
            -73.97459382459914,
            40.6869832790631
         ],
         "time":71,
         "stayDuration":1,
         "interior":1
      },
      {
         "name":"G Train Station Fulton St Stop Brooklyn Bound",
         "coordinates":[
            -73.97451543394936,
            40.68654786691209
         ],
         "time":73,
         "stayDuration":7,
         "interior":1
      },
      {
         "name":"Jay Street Metro Tech Station Willoughby Exit",
         "coordinates":[
            -73.98738813947614,
            40.69235204116163
         ],
         "time":84,
         "stayDuration":1,
         "interior":1
      },
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":89,
         "stayDuration":11,
         "interior":1
      }
   ],
   "Yi":[
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":0,
         "stayDuration":1,
         "interior":1
      },
      {
         "name":"Brooklyn House of Detention - across from",
         "coordinates":[
            -73.98939232701781,
            40.689565448764824
         ],
         "time":5,
         "stayDuration":9
      },
      {
         "name":"Albee Square",
         "coordinates":[
            -73.98344681831634,
            40.68994784305596
         ],
         "time":22,
         "stayDuration":4
      },
      {
         "name":"Transit Adjudication Bureau",
         "coordinates":[
            -73.98673281349062,
            40.69042539221124
         ],
         "time":32,
         "stayDuration":1
      },
      {
         "name":"McDonald's Fulton St",
         "coordinates":[
            -73.9861538135035,
            40.690823527448
         ],
         "time":34,
         "stayDuration":4
      },
      {
         "name":"McDonald's Fulton St",
         "coordinates":[
            -73.9861538135035,
            40.690823527448
         ],
         "time":38,
         "stayDuration":5,
         "interior":1
      },
      {
         "name":"Shake Shack",
         "coordinates":[
            -73.98881759372563,
            40.692154321583814
         ],
         "time":48,
         "stayDuration":5,
         "interior":1
      },
      {
         "name":"Antonio's Pizzeria",
         "coordinates":[
            -73.99097067971337,
            40.69289260483458
         ],
         "time":48,
         "stayDuration":12,
         "interior":1
      },
      {
         "name":"Startbucks Court Street",
         "coordinates":[
            -73.99122099998579,
            40.69234812360682
         ],
         "time":61,
         "stayDuration":27,
         "interior":1
      },
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":92,
         "stayDuration":8,
         "interior":1
      }
   ],
   "Sean":[
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":0,
         "stayDuration":0,
         "interior":1
      },
      {
         "name":"Court House Apartments",
         "coordinates":[
            -73.99173165443744,
            40.69013197694835
         ],
         "time":3,
         "stayDuration":5,
         "interior":1
      },
      {
         "name":"Garden Place",
         "coordinates":[
            -73.9964405283726,
            40.69237800375038
         ],
         "time":14,
         "stayDuration":0
      },
      {
         "name":"Sydney Place",
         "coordinates":[
            -73.99435557332862,
            40.69263447367899
         ],
         "time":19,
         "stayDuration":0
      },
      {
         "name":"Court St",
         "coordinates":[
            -73.99120274182877,
            40.69245014350602
         ],
         "time":28,
         "stayDuration":0
      },
      {
         "name":"Court House Apartments",
         "coordinates":[
            -73.99173165443744,
            40.69013197694835
         ],
         "time":32,
         "stayDuration":4,
         "interior":1
      },
      {
         "name":"Antonio's Pizzeria",
         "coordinates":[
            -73.99097067971337,
            40.69289260483458
         ],
         "time":40,
         "stayDuration":20,
         "interior":1
      },
      {
         "name":"Hank's",
         "coordinates":[
            -73.98844510495121,
            40.69237350291553
         ],
         "time":65,
         "stayDuration":1
      },
      {
         "name":"Willoughby Plaza",
         "coordinates":[
            -73.98845583979448,
            40.692257394867
         ],
         "time":66,
         "stayDuration":6
      },
      {
         "name":"Fressh 99 Cents Pizza",
         "coordinates":[
            -73.9870247024781,
            40.692315773904085
         ],
         "time":74,
         "stayDuration":5,
         "interior":1
      },
      {
         "name":"Metro Star",
         "coordinates":[
            -73.98726119362772,
            40.692729492972035
         ],
         "time":82,
         "stayDuration":4
      },
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":89,
         "stayDuration":11,
         "interior":1
      }
   ],
   "Dave":[
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":0,
         "stayDuration":1,
         "interior":1
      },
      {
         "name":"original Hank's Atlantic Ave",
         "coordinates":[
            -73.98844510495121,
            40.69237350291553
         ],
         "time":13,
         "stayDuration":3
      },
      {
         "name":"Transit Museum",
         "coordinates":[
            -73.98987036172696,
            40.690507592000074
         ],
         "time":27,
         "stayDuration":4
      },
      {
         "name":"Antonio's Pizzeria",
         "coordinates":[
            -73.99097067971337,
            40.69289260483458
         ],
         "time":34,
         "stayDuration":26,
         "interior":1
      },
      {
         "name":"Hank's",
         "coordinates":[
            -73.98093806075582,
            40.685288288842145
         ],
         "time":65,
         "stayDuration":1
      },
      {
         "name":"Willoughby Plaza",
         "coordinates":[
            -73.98845583979448,
            40.692257394867
         ],
         "time":66,
         "stayDuration":6
      },
      {
         "name":"Fressh 99 Cents Pizza",
         "coordinates":[
            -73.9870247024781,
            40.692315773904085
         ],
         "time":74,
         "stayDuration":5,
         "interior":1
      },
      {
         "name":"Metro Star",
         "coordinates":[
            -73.98726119362772,
            40.692729492972035
         ],
         "time":82,
         "stayDuration":4
      },
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":90,
         "stayDuration":10,
         "interior":1
      }
   ],
   "Julie":[
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":0,
         "stayDuration":1,
         "interior":1
      },
      {
         "name":"Macy's Fulton Mall",
         "coordinates":[
            -73.9856805852973,
            40.69064715576613
         ],
         "time":7,
         "stayDuration":21,
         "interior":1
      },
      {
         "name":"McDonald's Fulton St",
         "coordinates":[
            -73.9861538135035,
            40.690823527448
         ],
         "time":29,
         "stayDuration":15,
         "interior":1
      },
      {
         "name":"Macy's Fulton Mall",
         "coordinates":[
            -73.9856805852973,
            40.69064715576613
         ],
         "time":46,
         "stayDuration":18,
         "interior":1
      },
      {
         "name":"Macy's Fulton Mall",
         "coordinates":[
            -73.98582954757137,
            40.69074647314818
         ],
         "time":64,
         "stayDuration":4
      },
      {
         "name":"Startbucks Court Street",
         "coordinates":[
            -73.99122099998579,
            40.69234812360682
         ],
         "time":76,
         "stayDuration":12,
         "interior":1
      },
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":92,
         "stayDuration":8,
         "interior":1
      }
   ],
   "Catherine":[
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":0,
         "stayDuration":0,
         "interior":1
      },
      {
         "name":"Amberly Apartments",
         "coordinates":[
            -73.98683576050996,
            40.69785717990496
         ],
         "time":11,
         "stayDuration":13
      },
      {
         "name":"Belltel Apartments",
         "coordinates":[
            -73.98512109426878,
            40.692481809057
         ],
         "time":35,
         "stayDuration":43,
         "interior":1
      },
      {
         "name":"Circa Brewing Co.",
         "coordinates":[
            -73.98613399879105,
            40.69168028817751
         ],
         "time":79,
         "stayDuration":3,
         "interior":1
      },
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":88,
         "stayDuration":12,
         "interior":1
      }
   ],
   "Kenneth":[
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":0,
         "stayDuration":0,
         "interior":1
      },
      {
         "name":"Masison Kayser Court Street",
         "coordinates":[
            -73.99092207937201,
            40.69204633227292
         ],
         "time":3,
         "stayDuration":0,
         "interior":1
      },
      {
         "name":"Brooklyner",
         "coordinates":[
            -73.98611752487568,
            40.69267622682679
         ],
         "time":17,
         "stayDuration":24,
         "interior":1
      },
      {
         "name":"Belltel Apartments",
         "coordinates":[
            -73.98512109426878,
            40.692481809057
         ],
         "time":48,
         "stayDuration":26,
         "interior":25
      },
      {
         "name":"Willoughby Plaza",
         "coordinates":[
            -73.98845583979448,
            40.692257394867
         ],
         "time":78,
         "stayDuration":11
      },
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":91,
         "stayDuration":9,
         "interior":1
      }
   ],
   "Zay":[
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":0,
         "stayDuration":0,
         "interior":1
      },
      {
         "name":"Brooklyner",
         "coordinates":[
            -73.98611752487568,
            40.69267622682679
         ],
         "time":4,
         "stayDuration":40,
         "interior":1
      },
      {
         "name":"Uni K Wax Studio",
         "coordinates":[
            -73.98062198696374,
            40.687510673886436
         ],
         "time":57,
         "stayDuration":3
      },
      {
         "name":"Mono No Aware",
         "coordinates":[
            -73.99305893774243,
            40.69216613073874
         ],
         "time":61,
         "stayDuration":9,
         "interior":1
      },
      {
         "name":"Circa Brewing Co.",
         "coordinates":[
            -73.98613399879105,
            40.69168028817751
         ],
         "time":78,
         "stayDuration":6,
         "interior":1
      },
      {
         "name":"ISSUE Project Room",
         "coordinates":[
            -73.98952481348374,
            40.690692717192576
         ],
         "time":88,
         "stayDuration":12,
         "interior":1
      }
   ]
}
  </textarea>
</nav>

<main id="panel">

<div id="map"></div>
<div class="overlay">
    <button class="toggle-button">options</button>
</div>
</main>

<script>

var slideout = new Slideout({
'panel': document.getElementById('panel'),
'menu': document.getElementById('menu'),
'padding': 256,
'tolerance': 70
});

// Toggle button
document.querySelector('.toggle-button').addEventListener('click', function() {
slideout.toggle();
});

// top of script
mapboxgl.accessToken = 'pk.eyJ1IjoiYWFyb25kb3R3b3JrIiwiYSI6ImNrZjB5aGFkMzBxNzEycmxjZ3B3Zzh1MmYifQ.nO9RZS54KUxX_Xm-0Yr9iA';
var mapboxClient = mapboxSdk({ accessToken: mapboxgl.accessToken });


var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [-73.99042372887936, 40.692302258434665],
    zoom: 18
});

let sources = [];
let layers = [];

let journeys =
{
    "naomi" : [
        {
            name: "Issue Project Room",
            coordinates: [-73.98975327110401,40.690731932529246],
            time: 0,
        },
        {
            name: "Sephora",
            coordinates: [-73.99042372887936, 40.692302258434665],
            time: 6,
            stayDuration: 1,
        },
        {
            name: "Top Beauty",
            coordinates: [-73.98713054232593, 40.69189139301244],
            time: 16,
            stayDuration: 15,
        },
        {
            name: "Beauty 35",
            coordinates: [-73.98399300000335,40.690241797368174],
            time: 37,
            stayDuration: 10,
        }
    ],
    "naomi2" : [
        {
            name: "Beauty 35",
            coordinates: [-73.98399300000335,40.690241797368174],
            time: 0,
        },
        {
            name: "Sephora",
            coordinates: [-73.99042372887936, 40.692302258434665],
            time: 6,
            stayDuration: 1,
        },
        {
            name: "Top Beauty",
            coordinates: [-73.98713054232593, 40.69189139301244],
            time: 16,
            stayDuration: 15,
        },
        {
            name: "Issue Project Room",
            coordinates: [-73.98975327110401,40.690731932529246],
            time: 37,
        }
    ]
};

let animations = [];

let currentIteration = -1;
let jsonToMap = function() {
    currentIteration++;
    // if (layers.length > 0) {
    //     for (let layer of layers) {
    //         map.removeLayer(layer);
    //     }
    //     layers = [];
    // }
    // if (sources.length > 0) {
    //     for (let source of sources) {
    //         map.removeSource(source);
    //     }
    //     sources = [];
    // }
    map.remove();
    map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-73.99042372887936, 40.692302258434665],
        zoom: 26
    });
    for (let name in journeys) {
        let journey = journeys[name];
        for (let leg of journey) {
            if (isNaN(leg.stayDuration)) leg.stayDuration = 0;
            let id = 'point' + Math.random();

            let point = {
                'type': 'FeatureCollection',
                'features': [
                    {
                        'type': 'Feature',
                        'properties': {},
                        'geometry': {
                            'type': 'Point',
                            'coordinates': leg.coordinates
                        }
                    }
                ]
            };

            let onLoad = () => {
                let marker = new mapboxgl.Marker()
                    .setLngLat(leg.coordinates)
                    .addTo(map);
                // map.addSource(id, {
                //     'type': 'geojson',
                //     'data': point
                // });
                // sources.push(id);
                // map.addLayer({
                //     'id': id,
                //     'source': id,
                //     'type': 'symbol',
                //     'layout': {
                //         'icon-image': 'marker-15',
                //         'icon-rotate': ['get', 'bearing'],
                //         'icon-rotation-alignment': 'map',
                //         'icon-allow-overlap': true,
                //         'icon-ignore-placement': true
                //     }
                // });
                // layers.push(id);
            };
            // if (!map.loaded()) {
            //     map.on('load', onLoad);
            // }
            // else {
            //     onLoad();
            // }
        }
        let routes = [];
        let numRoutesFilled = 0;
        let myIteration = currentIteration;
        for (let i = 1; i < journey.length; i++) {
            routes.push[{}];
            mapboxClient.directions.getDirections({
                profile: 'walking',
                geometries: 'geojson',
                waypoints: [
                    journey[i - 1],
                    journey[i],
                ]
            })
              .send()
              .then(response => {
                const directions = response.body;
                // console.log("mapping request");
                // console.log(directions);
                let routeGeometry = directions.routes[0].geometry;
                routeGeometry.time = journey[i - 1].time;
                routeGeometry.duration = journey[i].time - journey[i - 1].time - journey[i - 1].stayDuration;
                routeGeometry.stayDuration = journey[i - 1].stayDuration;
                if (routeGeometry.duration < 0) {
                  console.log("wtf?" + name);
                }
                if (routeGeometry.duration < routeGeometry.stayDuration) {
                  console.log("????" + name)
                }
                routes[i - 1] = routeGeometry;
                numRoutesFilled += 1;
                if (numRoutesFilled >= journey.length - 1) {
                    let actor = new ActorPath(map);
                    for (let route of routes) {
                        actor.addGeometry(route);
                    }
                    actor.finalize();
                    sources.push(actor.id);
                    layers.push(actor.id);
                    function animate() {
                        if (myIteration != currentIteration) return;
                        actor.render(Date.now() / 1000 % 47);
                        if (name == "Naomi") {
                           map.flyTo({
                           center: actor.point.features[0].geometry.coordinates
                           });
                        }
                    }
                    animations.push(animate);
                }
                let pointCounter = Math.random();
                let onLoad = function() {
                   if (name == "Naomi") {
                       var route = {
                           'type': 'FeatureCollection',
                           'features': [
                               {
                                   'type': 'Feature',
                                   "geometry": routeGeometry,
                               }
                           ]
                       };
                       // Add a source and layer displaying a point which will be animated in a circle.
                       map.addSource('route' + pointCounter, {
                           'type': 'geojson',
                           'data': route
                       });


                       map.addLayer({
                           'id': 'route' + pointCounter,
                           'source': 'route' + pointCounter,
                           'type': 'line',
                           'paint': {
                               'line-width': 2,
                               'line-color': '#007cbf'
                           }
                       });
                    }
                 }
                  if (!map.loaded()) {
                      map.on('load', onLoad);
                  }
                  else {
                      onLoad();
                  }
                // init(routeGeometry);
            });
        }
    }
}

function animateAll() {
    for (let anim of animations) {
        anim();
    }
    requestAnimationFrame(animateAll);
}
requestAnimationFrame(animateAll);

const selectElement = document.querySelector('#json');

selectElement.addEventListener('change', (event) => {
    journeys = JSON.parse(event.target.value);
    jsonToMap();
    localStorage.setItem('actorsJson', event.target.value);
});

// if (localStorage.getItem('actorsJson') != null) {
//     selectElement.value = localStorage.getItem('actorsJson');
// }
journeys = JSON.parse(selectElement.value);
jsonToMap();


// let reparsed = [];
// Papa.parse("locations.csv", {
//   download: true,
//   complete: function(results) {
//       for (let row of results.data) {
//         if (row.length < 2) continue;
//         let label = row[0];
//         let reparsedRow = [label];
//         console.log(row[1]);
//         let json = JSON.parse(row[1]);
//         console.log(json);
//         for (let feature of json.features) {
//           reparsedRow.push(feature.place_name);
//         }
//         reparsed.push(reparsedRow);
//       }
//       console.log(Papa.unparse(reparsed));
//     }
//   });

// let places = new Set();
// Papa.parse("min-by-min.tsv", {
//   download: true,
//   complete: function(results) {
//     console.log(results);
//     for (let i = 1; i < results.data.length; i ++) {
//       let row = results.data[i];
//       for (let j = 2; j < row.length && j < 3; j++) {
//         places.add(row[j]);
//         //console.log(row[j]);
//       }
//     }
//   console.log("places");
//   console.log(places);

// let responsesFound = 0;
// let responses = [];
//console.log("geocoding");
//for (let item of places) {
//  console.log(item);
//  mapboxClient.geocoding.forwardGeocode({
//    query: item,
//    limit: 2
//  })
//    .send()
//    .then(response => {
//      responsesFound += 1;
//         responses.push([item, response.rawBody]);
//      console.log(Papa.unparse(responses));
//    });
//}
//   }
// });

  


    // // San Francisco
    // var origin = [
    //     -73.974663,
    //     40.685474];

    // // Washington DC
    // var destination = [
    //     -73.972694,
    //     40.685921];
  //   [
  //   {
  //     "distance": 27.549,
  //     "name": "Hanson Place",
  //     "location": [
  //     ]
  //   },
  //   {
  //     "distance": 3.875,
  //     "name": "Greene Avenue",
  //     "location": [
  //     ]
  //   }
  // ],



// let totalPoints = 0;
// function init(routeGeometry) {
//     let pointCounter = totalPoints;
//     // A simple line from origin to destination.
//     var route = {
//         'type': 'FeatureCollection',
//         'features': [
//             {
//                 'type': 'Feature',
//                 "geometry": routeGeometry,
//             }
//         ]
//     };

//     // A single point that animates along the route.
//     // Coordinates are initially set to origin.
//     var point = {
//         'type': 'FeatureCollection',
//         'features': [
//             {
//                 'type': 'Feature',
//                 'properties': {},
//                 'geometry': {
//                     'type': 'Point',
//                     'coordinates': origin
//                 }
//             }
//         ]
//     };

//     // Calculate the distance in kilometers between route start/end point.
//     var lineDistance = turf.lineDistance(route.features[0], 'kilometers');

//     var arc = [];

//     // Number of steps to use in the arc and animation, more steps means
//     // a smoother arc and animation, but too many steps will result in a
//     // low frame rate
//     var steps = 500;

//     // Draw an arc between the `origin` & `destination` of the two points
//     for (var i = 0; i < lineDistance; i += lineDistance / steps) {
//         var segment = turf.along(route.features[0], i, 'kilometers');
//         arc.push(segment.geometry.coordinates);
//     }

//     // Update the route with calculated arc coordinates
//     route.features[0].geometry.coordinates = arc;

//     // Used to increment the value of the point measurement against the route.
//     var counter = 0;

//     map.on('load', function () {
//         // Add a source and layer displaying a point which will be animated in a circle.
//         map.addSource('route' + pointCounter, {
//             'type': 'geojson',
//             'data': route
//         });

//         map.addSource('point' + pointCounter, {
//             'type': 'geojson',
//             'data': point
//         });

//         map.addLayer({
//             'id': 'route' + pointCounter,
//             'source': 'route' + pointCounter,
//             'type': 'line',
//             'paint': {
//                 'line-width': 2,
//                 'line-color': '#007cbf'
//             }
//         });

//         map.addLayer({
//             'id': 'point' + pointCounter,
//             'source': 'point' + pointCounter,
//             'type': 'symbol',
//             'layout': {
//                 'icon-image': 'airport-15',
//                 'icon-rotate': ['get', 'bearing'],
//                 'icon-rotation-alignment': 'map',
//                 'icon-allow-overlap': true,
//                 'icon-ignore-placement': true
//             }
//         });

//         function animate() {
//             // Update point geometry to a new position based on counter denoting
//             // the index to access the arc.
//             point.features[0].geometry.coordinates =
//                 route.features[0].geometry.coordinates[counter];

//             // Calculate the bearing to ensure the icon is rotated to match the route arc
//             // The bearing is calculate between the current point and the next point, except
//             // at the end of the arc use the previous point and the current point
//             point.features[0].properties.bearing = turf.bearing(
//                 turf.point(
//                     route.features[0].geometry.coordinates[
//                         counter >= steps ? counter - 1 : counter
//                     ]
//                 ),
//                 turf.point(
//                     route.features[0].geometry.coordinates[
//                         counter >= steps ? counter : counter + 1
//                     ]
//                 )
//             );

//             // Update the source with this new data.
//             map.getSource('point' + pointCounter).setData(point);

//             // Request the next frame of animation so long the end has not been reached.
//             if (counter < steps) {
//                 requestAnimationFrame(animate);
//             }

//             counter = counter + 1;
//         }

//         document
//             .getElementById('replay')
//             .addEventListener('click', function () {
//                 // Set the coordinates of the original point back to origin
//                 point.features[0].geometry.coordinates = origin;

//                 // Update the source layer
//                 map.getSource('point' + pointCounter).setData(point);

//                 // Reset the counter
//                 counter = 0;

//                 // Restart the animation.
//                 animate(counter);
//             });

//         // Start the animation.
//         animate(counter);
//     });
//     totalPoints = totalPoints + 1;
// }

// pk.eyJ1IjoiYWFyb25kb3R3b3JrIiwiYSI6ImNrZjB5aGFkMzBxNzEycmxjZ3B3Zzh1MmYifQ.nO9RZS54KUxX_Xm-0Yr9iA

// https://api.mapbox.com/matching/v5/mapbox/walking/-73.93132,40.682431;-73.972688,40.685886.json?access_token=pk.eyJ1IjoiYWFyb25kb3R3b3JrIiwiYSI6ImNrZjB5aGFkMzBxNzEycmxjZ3B3Zzh1MmYifQ.nO9RZS54KUxX_Xm-0Yr9iA

// https://api.mapbox.com/directions/v5/mapbox/walking/-73.974609,40.68523;-73.972688,40.685886.json?access_token=pk.eyJ1IjoiYWFyb25kb3R3b3JrIiwiYSI6ImNrZjB5aGFkMzBxNzEycmxjZ3B3Zzh1MmYifQ.nO9RZS54KUxX_Xm-0Yr9iA&overview=full&geometries=geojson

</script>

</body>
</html>
